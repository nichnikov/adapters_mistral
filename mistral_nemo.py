import os
from mistral_inference.transformer import Transformer
from mistral_inference.generate import generate

from mistral_common.tokens.tokenizers.mistral import MistralTokenizer
from mistral_common.protocol.instruct.messages import UserMessage
from mistral_common.protocol.instruct.request import ChatCompletionRequest

mistral_models_path = os.path.join(os.getcwd(), "models", "mistral_models", "Nemo-Instruct")
tokenizer = MistralTokenizer.from_file(f"{mistral_models_path}/tekken.json")
model = Transformer.from_folder(mistral_models_path)

messages = [{"role": "user", "content": "Вопрос: Имеет ли право самозанятый (физлицо без регистрации ИП) выступить учредителем ООО и стать в нем директором? Не потеряет он статус самозанятого? Контекст: Учредители и участники организаций могут быть самозанятыми и платить налог на профдоход при оказании услуг и выполнении работ. НПД можно облагать доходы, которые не связаны с работой в качестве учредителя или участника: дивиденды НПД не облагаются. Такой вывод следует из статьи 4 Закона от 27.11.2018 № 422-ФЗ. В рамках НПД учредитель вправе оказывать услуги и выполнять работы в пользу своей организации по ГПД. Например, оказывать юридические услуги по регистрации недвижимости, ремонтировать имущество. Виды деятельности, которые нельзя перевести на НПД, перечислены в пункте 2 статьи 4 и пункте 2 статьи 6 Закона от 27.11.2018 № 422-ФЗ. НПД не вправе платить учредители, у которых с заказчиком действует трудовой договор или у которых трудовой договор расторгнут менее двух лет назад (подп. 8 п. 2 ст. 6 Закона от 27.11.2018 № 422-ФЗ, письмо Минфина от 18.08.2022 № 03-11-11/80767). Получение дивидендов не связано с оказанием услуг и выполнением работ. Это доход, полученный акционером или участником от организации при распределении прибыли (п. 1 ст. 43 НК). Поэтому в отношении дивидендов учредитель не вправе применять НПД. А значит, с дивидендов учредитель обязан уплачивать НДФЛ в общем порядке. Плательщики налога на профессиональный доход вправе совмещать деятельность на этом спецрежиме с работой по найму. С зарплаты наниматель заплатит НДФЛ и страховые взносы (подп. 8 п. 2 ст. 6 Закона от 27.11.2018 № 422-ФЗ). Налогом на профессиональный доход будут облагаться доходы от переведенных на этот спецрежим видов деятельности (п. 1 ст. 6 Закона от 27.11.2018 № 422-ФЗ, письма ФНС от 28.08.2019 № СД-4-3/17127 и от 25.01.2019 № СД-3-3/458)."}, 
            {"role": "user", "content": "Вопрос: Здравствуйте, А если приобретенный товар менее 100 тыс (но срок использования от 12 мес) его можно списать в основные средства? Контекст: Включите стоимость такого имущества в состав материальных расходов.При расчете налога на прибыль амортизируемым признается имущество со сроком полезного использования более 12 месяцев и первоначальной стоимостью более 100 000 руб. (п. 1 ст. 256 НК). Малоценное имущество (объекты стоимостью менее 100 000 руб. и со сроком службы более 12 месяцев) удовлетворяет лишь одному из названных критериев. Поэтому для расчета налога на прибыль в состав амортизируемого имущества такие объекты не включаются. Стоимость малоценного имущества включайте в состав материальных расходов. Порядок списания такого имущества разработайте самостоятельно и закрепите в учетной политике для целей налогообложения (например, единовременно в момент ввода в эксплуатацию, равномерно в течение срока использования). Законодательство не допускает разных способов списания материальных расходов в зависимости от стоимости активов. Поэтому если решили списывать малоценное имущество (например, инструмент, инвентарь, приборы, лабораторное оборудование) равномерно в течение срока его использования, то этот порядок применяйте не только к объектам стоимостью от 40 000 до 100 000 руб., но и к более дешевым. Это следует из положений подпункта 3 пункта 1 статьи 254 НК. Аналогичные разъяснения содержат письма Минфина от 26.05.2016 № 03-03-06/1/30414, от 20.05.2016 № 03-03-06/1/29124."},
            {"role": "user", "content": "Вопрос: Облагается ли НДФЛ дарение квартиры от сына матери и от матери дочери? Контекст: Некоторые виды доходов резидентов и нерезидентов освобождены от НДФЛ. Необлагаемые доходы перечислены в пунктах 2 и 5 статьи 208, статьях 215 и 217 НК. Например, это следующие выплаты: 1. Различные компенсационные, социальные и бюджетные выплаты, которые установлены законодательством: пенсии (п. 2 ст. 217 НК); суммы возмещения вреда от увечья или иного повреждения здоровья (п. 1 ст. 217 НК). Сюда относят и возмещение морального вреда по решению суда в денежной и натуральной формах (письма Минфина от 28.03.2016 № 03-04-05/17184 и от 28.08.2012 № 03-04-05/6-1009); вознаграждение за сданную кровь, материнское молоко и иную помощь (п. 4 ст. 217 НК);полученные алименты (п. 5 ст. 217 НК); социальная помощь, которую выплачивают на основании законодательства (п. 79 ст. 217 НК); единовременные выплаты работодателя в пользу сотрудника в связи со смертью члена его семьи либо в пользу членов семьи умершего сотрудника (абз. 1, 3 п. 8 ст. 217 НК); единовременные выплаты при рождении или усыновлении ребенка, которые работодатель произвел в течение первого года после рождения либо усыновления, но не более 50 тыс. руб. на каждого ребенка (абз. 1, 7 п. 8 ст. 217 НК); компенсация части родительской платы за обучение ребенка в государственных и муниципальных дошкольных образовательных учреждениях (п. 42 ст. 217 НК);оплата работодателем независимой оценки квалификации сотрудника на соответствие профстандартам (п. 21.1 ст. 217 НК); средства материнского (семейного) капитала, а также дополнительные выплаты в поддержку семей с детьми, установленные региональными и муниципальными актами в соответствии с Законом от 29.12.2006 № 256-ФЗ (п. 34 ст. 217 НК). 3. Доходы в виде подарков, выигрышей и призов: подарки в виде недвижимого имущества, транспортных средств, акций, долей, паев, если они получены от людей, которые являются членами семьи и (или) близкими родственниками (абз. 2 п. 18.1 ст. 217 НК); другие подарки (например, деньги в виде чаевых), которые получены от любых людей, независимо от того, являются они родственниками или нет (абз. 1 п. 18.1 ст. 217 НК, письма Минфина от 13.08.2020 № 03-04-05/71002, от 29.05.2018 № 03-04-05/36431);"},
            {"role": "user", "content": "Вопрос: Как правильно отразить в учете изменение элементов амортизации? Какие должны быть проводки? Контекст: Как отразить корректировку из-за изменения элементов амортизации. Корректировки отражаются в бухучете как изменения оценочных значений (п. 37 ФСБУ 6/2020, п. 3 ПБУ 21/2008). Это не исправление ошибок. Изменение оценочных значений отражается в бухучете перспективно без пересчета ранее начисленной амортизации (п. 4 ПБУ 21/2008). Корректирующих проводок не делайте. Таким образом, после изменения элементов начисляйте амортизацию исходя из нового расчета. Если начисляете амортизацию с 1-го числа следующего месяца, то новые суммы амортизации отражайте с 1-го числа месяца, следующего за пересмотром. Если амортизацию начисляете с даты принятия объекта на учет, то новый расчет применяйте с даты изменения элементов амортизации. Отдельно проанализируйте основные средства, амортизация которых ранее была приостановлена из-за того, что ликвидационная стоимость стала больше или равна балансовой (п. 30 ФСБУ 6/2020). После пересмотра элементов ликвидационная стоимость может стать меньше балансовой стоимости. В этом случае начисление амортизации нужно возобновить (информационное сообщение Минфина от 03.11.2020 № ИС-учет-29)."},
            {"role": "user", "content": "Вопрос: Как произвести расчет налога по ПСН (по какой формуле)?  Контекст: Расчет суммы налога по патенту Сумму налога по патенту инспекторы считают по правилам пункта 1 статьи 346.51 НК. Налог за календарный год считают по формуле: Налог за календарный год = Налоговая база (потенциально возможный годовой доход) × Налоговая ставка Налог за период менее календарного года считают по формуле: Налог за период менее календарного года = Налоговая база(потенциально возможный годовой доход) : Количество календарных дней в году × Количество дней, на которые выдан патент Примерно рассчитать сумму налога можно в Калькуляторе патента на сайте ФНС. При этом нужно учитывать, что налог по ПСН рассчитывается на дату получения информации от субъекта РФ."},
            {"role": "user", "content": "Вопрос: Какие налоговые  последствия возникают у предприятия при безвозмездной передаче автомобиля муниципальному предприятию? Контекст: Как отразить безвозмездную передачу основных средств при расчете налога на прибыль и НДС Налог на прибыль. При безвозмездной передаче основного средства в налоговом учете доходов не возникает (ст. 249, 250 НК). Остаточная стоимость и другие расходы, связанные с безвозмездной передачей объекта, при расчете налога на прибыль по общему правилу не учитываются (п. 16 ст. 270 НК, письмо Минфина от 27.12.2019 № 03-03-07/102491), но есть исключения. Первое исключение – основные средства, безвозмездно переданные для борьбы с коронавирусом. Их стоимость при расчете налога на прибыль можно учесть во внереализационных расходах. Условия и ограничения для этого перечислены в подпунктах 19.5 и 19.6 пункта 1 статьи 265 НК. Подробнее – в рекомендации.  Второе исключение – основные средства, которые компания приобрела за счет средств субсидий на амортизируемое имущество. Если она безвозмездно передала такие объекты в государственную или муниципальную собственность, то их стоимость можно учесть в расходах при расчете налога на прибыль. Ограничение по размеру – сумма субсидий, которая учтена во внереализационных доходах по абзацу 3 пункта 4.1 статьи 271 НК. Подробнее о том, как учесть субсидии на основные средства, – в рекомендации.  Со следующего месяца после передачи основного средства исключите его стоимость из налоговой базы по налогу на имущество (п. 4 ст. 376 НК). При этом учитывайте особенности, связанные с продажей недвижимости. НДС. Безвозмездная передача объекта основных средств признается реализацией при исчислении НДС (п. 1 ст. 39 НК). Поэтому с нее нужно начислить и заплатить НДС (подп. 1 п. 1 ст. 146 НК). НДС начислите в момент передачи объекта основных средств (п. 1 ст. 167 НК). При этом сделайте проводку: Дебет 91-2 Кредит 68 субсчет «Расчеты по НДС» – начислен НДС при безвозмездной передаче основного средства. Сумма НДС, начисленная на стоимость безвозмездно переданного основного средства, не уменьшает налоговую базу по налогу на прибыль (п. 16 ст. 270 НК, письма Минфина от 08.12.2009 № 03-03-06/1/792, ФНС от 20.11.2006 № 02-1-07/92). Из-за различий в бухгалтерском и налоговом учете правил учета остаточной стоимости и других расходов, связанных с безвозмездной передачей основного средства, а также начисленной при этом суммы НДС возникает разница между видами учета. Но при балансовом методе отдельно отражать ее в бухучете не надо. Все разницы отразите на конец отчетного периода, когда будете сравнивать стоимость активов и обязательств в бухгалтерском учете и для целей налогообложения. Подробнее об этом читайте в рекомендации Как начислять налог на прибыль и учитывать разницы по ПБУ 18/02.  Входной НДС по затратам, связанным с передачей основного средства, принимайте к вычету в момент их отражения в учете (например, на счете 91-2 – по работам и услугам, на счете 10 – по материалам, используемым для упаковки продаваемого основного средства) (п. 1 ст. 171, п. 1 ст. 172 НК). Наряду с этим должны быть выполнены другие условия, обязательные для вычета. При этом делайте проводку: Дебет 68 субсчет «Расчеты по НДС» Кредит 19 – принят к вычету входной НДС по затратам, связанным с безвозмездной передачей основного средства. Некоторые виды операций по безвозмездной передаче имущества НДС не облагаются. Какие операции не облагают НДС – в отдельной рекомендации."},
            {"role": "user", "content": "Вопрос: Добрый день, чем возможно заменить командировочное удостоверение? Сотрудники часто стали возвращать командировочне удостоверения без отметок. Контекст: Как и когда оформлять служебные записки в связи с командировками Служебную записку необходимо оформить, если: сотрудник едет в командировку (или обратно) на личном, арендованном или служебном транспорте; по возвращении из командировки у сотрудника нет вообще никаких документов, подтверждающих проезд и проживание в поездке. В первом случае фактический срок пребывания в месте командирования сотрудник указывает в служебной записке, которую он представляет работодателю вместе с оправдательными документами, подтверждающими использование транспорта: путевым листом, счетами, квитанциями, кассовыми чеками и т. д. Во втором случае сотрудник оформляет служебную записку , которая должна содержать подтверждение принимающей стороны о сроке прибытия сотрудника к месту командирования и выбытия обратно. К ней он прикладывает документ, в котором принимающая организация подтверждает, что он находился в это время по месту командирования. Служебную записку сотрудник составляет самостоятельно, вернувшись из командировки. Об этом сказано в пункте 7 положения, утвержденного постановлением Правительства от 13.10.2008 № 749. А вот оформление служебных записок о направлении в командировку ни одним нормативным актом не предусмотрено. Но если руководство организации сочтет составление таких записок целесообразным, это правило можно закрепить локальным документом (п. 3 положения, утв. постановлением Правительства от 13.10.2008 № 749). Например, приказом директора или положением о командировках. Разработка таких документов не запрещена. Служебные записки могут понадобиться в других ситуациях. Например, если сотрудник задержался в командировке по уважительной причине (производственная необходимость, отсутствие проездных билетов и т. п.). В таком случае по служебной записке на имя руководителя продолжительность командировки ему можно продлить."},
            {"role": "user", "content": "Вопрос: Добрый день! Компания купила прослеживаемый товар Монитор и поставила на 01 счет. Вопрос: Необходимо ли подавать какие-либо сведения и куда, и в какие сроки ? Контекст: Подать уведомление нужно в электронном виде по ТКС один раз в разрезе кода ТН ВЭД ЕАЭС каждого наименования прослеживаемого товара. С 18 января 2024 года уточнили срок подачи уведомления. Направить документ в ФНС надо не позднее дня совершения одной из операций, которые поименованы в пункте 28 положения о национальной системе прослеживаемости. Например, к таким операциям относятся: реализация и перемещение прослеживаемых товаров за пределы РФ и иных территорий, находящихся под ее юрисдикцией; реализация прослеживаемых товаров на территории РФ; передача прослеживаемых товаров в составе выполненных работ. ФНС известит о присвоении регистрационного номера партии товаров (РНПТ) не позднее следующего календарного дня с даты получения уведомления (п. 29 положения о национальной системе прослеживаемости). Как заполнить  Порядок заполнения уведомления прописан в приложении 7 к приказу ФНС от 08.07.2021 № ЕД-7-15/645@. В частности, в строках и графах табличной части уведомления указывают: номер корректировки (в первоначальном документе проставляют ноль); наименование, ИНН и КПП участника; номер и дату акта инвентаризации или инвентаризационной описи; наименования товаров, числящихся в остатках, их коды по ТН ВЭД ЕАЭС, по ОКПД2, количество и стоимость без НДС. Если подаете уведомление об остатках прослеживаемых основных средств, в строке 18 отражайте их остаточную балансовую стоимость в размере по состоянию на дату оформления по результатам инвентаризации первичного учетного документа. В строке 18 проставьте ноль, если основное средство полностью самортизировано. Прослеживаемый товар может входить в комплект, в котором является составной частью основного средства или малоценного имущества. В этом случае в строке 18 уведомления укажите пропорциональную часть стоимости всего основного средства или малоценного имущества либо ноль, если основное средство полностью самортизировано. Стоимость малоценного имущества за балансом можете отражать в строке 18 уведомления в оценке, которую применяете для контроля и учета движения на забалансовых счетах (письмо ФНС от 01.09.2021 № ЕА-4-15/12338). Неверно указанный в документе код ТН ВЭД ЕАЭС станет причиной отказа в приеме уведомления. Чтобы избежать отказа, налоговики рекомендуют перед инвентаризацией ознакомиться с перечнем прослеживаемых товаров, справочником кодов ТН ВЭД ЕАЭС, а также воспользоваться сервисом прослеживаемости (информация ФНС от 03.09.2021)."},
            {"role": "user", 
             "content": "Вопрос: Подскажите, пожалуйста, как действовать в ситуации, когда сотрудник открыл больничный лист находясь в отпуске за свой счет (без сохранения заработной платы)? \
                 Контекст: Больничный, который приходится на дни отпуска без сохранения зарплаты, оплате не подлежит. Остальные дни временной нетрудоспособности оплатите в общем порядке. Это предусмотрено пунктом 1 части 1 статьи 9 Закона от 29.12.2006 № 255-ФЗ, подпунктом «а» пункта 17 положения, утвержденного постановлением Правительства от 15.06.2007 № 375. Если сотрудник заболел во время отпуска за свой счет, а выздоровел по его окончании, то оплатите дни болезни с даты окончания отпуска до дня выздоровления. Аналогичный порядок действует, если сотрудник заболел до начала неоплачиваемого отпуска, а выздоровел во время отпуска. Оплатите пособие со дня начала болезни до даты начала отпуска. Перенос или продление отпуска без сохранения зарплаты на более поздний период законодательством не предусмотрены. Можно перенести или продлить только ежегодный оплачиваемый отпуск (ст. 124 ТК). При этом сотрудник может прервать отпуск за свой счет, подав соответствующее заявление работодателю."}] 

for prmt in messages:
    prompt = "Ты квалифицированный бухгалтер, нужно дать развернутый ответ на вопрос, используй всю информацию из контекста. " + str(prmt["content"])
    print("prompt:\n", prompt)
    # prompt = "How expensive would it be to ask a window cleaner to clean all windows in Paris. Make a reasonable guess in US Dollar."

    completion_request = ChatCompletionRequest(messages=[UserMessage(content=prompt)])

    tokens = tokenizer.encode_chat_completion(completion_request).tokens

    out_tokens, _ = generate([tokens], model, max_tokens=64, temperature=0.35, eos_id=tokenizer.instruct_tokenizer.tokenizer.eos_id)
    result = tokenizer.decode(out_tokens[0])

    print("\nresult:\n", result)